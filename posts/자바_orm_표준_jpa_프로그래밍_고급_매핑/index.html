<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="자바 ORM 표준 JPA 프로그래밍 - 고급 매핑" /><meta property="og:locale" content="en" /><meta name="description" content="Table of Contents" /><meta property="og:description" content="Table of Contents" /><link rel="canonical" href="https://appchemist.github.io/posts/%EC%9E%90%EB%B0%94_orm_%ED%91%9C%EC%A4%80_jpa_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D_%EA%B3%A0%EA%B8%89_%EB%A7%A4%ED%95%91/" /><meta property="og:url" content="https://appchemist.github.io/posts/%EC%9E%90%EB%B0%94_orm_%ED%91%9C%EC%A4%80_jpa_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D_%EA%B3%A0%EA%B8%89_%EB%A7%A4%ED%95%91/" /><meta property="og:site_name" content="Appchemist" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-04-27T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="자바 ORM 표준 JPA 프로그래밍 - 고급 매핑" /><meta name="twitter:site" content="@appchemist" /><meta name="google-site-verification" content="ayKW7N1F1Lf9GFGDgfNENpw486FaeJYvFrGByBGAGEI" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-04-27T00:00:00+09:00","datePublished":"2021-04-27T00:00:00+09:00","description":"Table of Contents","headline":"자바 ORM 표준 JPA 프로그래밍 - 고급 매핑","mainEntityOfPage":{"@type":"WebPage","@id":"https://appchemist.github.io/posts/%EC%9E%90%EB%B0%94_orm_%ED%91%9C%EC%A4%80_jpa_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D_%EA%B3%A0%EA%B8%89_%EB%A7%A4%ED%95%91/"},"url":"https://appchemist.github.io/posts/%EC%9E%90%EB%B0%94_orm_%ED%91%9C%EC%A4%80_jpa_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D_%EA%B3%A0%EA%B8%89_%EB%A7%A4%ED%95%91/"}</script><title>자바 ORM 표준 JPA 프로그래밍 - 고급 매핑 | Appchemist</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Appchemist"><meta name="application-name" content="Appchemist"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://avatars.githubusercontent.com/u/1546031?v=4 " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Appchemist</a></div><div class="site-subtitle font-italic">Software Developer, Want to being a Developer likes alchemist.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/appchemist" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/appchemist" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['appchemist','hotmail.co.kr'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>자바 ORM 표준 JPA 프로그래밍 - 고급 매핑</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>자바 ORM 표준 JPA 프로그래밍 - 고급 매핑</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/appchemist">appchemist</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1619449200" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2021-04-27 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4306 words"> <em>23 min</em> read</span></div></div></div><div class="post-content"><h1 id="table-of-contents">Table of Contents</h1><ol><li><a href="#org74b2712">상속 관계 매핑</a><ol><li><a href="#org57bdac2">조인 전략</a><ol><li><a href="#org590a6cd">장점</a><li><a href="#orgc441028">단점</a><li><a href="#org17e1f8d">특징</a></ol><li><a href="#org655c921">단일 테이블 전략</a><ol><li><a href="#org513b7f3">장점</a><li><a href="#orgbfe0397">단점</a><li><a href="#org970d7c5">특징</a></ol><li><a href="#orgde8a547">구현 클래스마다 테이블 전략</a><ol><li><a href="#org6692670">장점</a><li><a href="#org6f3691e">단점</a><li><a href="#orgf23ef9c">특징</a></ol></ol><li><a href="#org931965f">@MappedSuperclass</a><li><a href="#orgf08c43d">복합 키와 식별 관계 매핑</a><ol><li><a href="#org49baaec">식별 관계 vs 비식별 관계</a><ol><li><a href="#orgc7242db">식별 관계</a><li><a href="#org5bec718">비식별 관계</a></ol><li><a href="#orgccaecae">복합 키: 비식별 관계 매핑</a><ol><li><a href="#org2274c90">@IdClass</a><li><a href="#orgf80d8fc">@EmbeddedId</a><li><a href="#org779cfed">@IdClass vs @EmbeddabledId</a></ol><li><a href="#orgaf011be">복합 키: 식별 관계 매핑</a><ol><li><a href="#org78f3d49">@IdClass와 식별관계</a><li><a href="#org8131d4f">@EmbeddabledId와 식별 관계</a></ol><li><a href="#org462cee1">비식별 관계로 구현</a><li><a href="#orgd73e6a2">일대일 식별 관계</a><li><a href="#org0c2a576">식별, 비식별 관계의 장단점</a></ol><li><a href="#orga69d623">조인 테이블</a><ol><li><a href="#orgea71808">일대일 조인 테이블</a><li><a href="#org30b303f">일대다 조인 테이블</a><li><a href="#org16fcb7d">다대일 조인 테이블</a><li><a href="#org25356d9">다대다 조인 테이블</a></ol><li><a href="#org989aae8">엔티티 하나에 여러 테이블 매핑</a></ol><p><a id="org74b2712"></a></p><h1 id="상속-관계-매핑">상속 관계 매핑</h1><p>관계형 데이터베이스에는 객체지향 언어에서 다루는 상속이라는 개념이 없다. 대신 슈퍼타입 서브타입 관계라는 모델링 기법이 객체의 상속 개념과 가장 유사하다.<br /> ORM에서 이야기하는 상속 관계 매핑은 객체의 상속 구조와 데이터베이스의 슈퍼타입 서브타입 관계를 매핑하는 것.</p><p>슈퍼타입 서브타입 논리 모델을 실제 물리 모델인 테이블로 구현할 때는 3가지 방법을 선택</p><ul><li>각각의 테이블로 변환 : 모두 테이블로 만들고 조회할 때 조인을 사용. JPA에서는 <strong>조인 전략</strong> 이라 한다.<li>통합 테이블로 변환 : 테이블을 하나만 사용해서 통합한다. JPA에서는 <strong>단일 테이블 전략</strong> 이라 한다.<li>서브타입 테이블로 변환 : 서브 타입마다 하나의 테이블을 만든다. JPA에서는 <strong>구현 클래스마다 테이블 전략</strong> 이라 한다.</ul><p><a id="org57bdac2"></a></p><h2 id="조인-전략"><span class="mr-2">조인 전략</span><a href="#조인-전략" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>엔티티 각각을 모두 테이블로 만들고 자식 테이블이 부모 테이블의 기본 키를 받아서 기본 키 + 외래 키로 사용하는 전략<br /> 객체는 타입으로 구분할 수 있지만 테이블은 타입의 개념이 없다. 따라서 <strong>타입을 구분하는 컬럼을 추가</strong> 해야 한다.</p><p><img data-src="/assets/img/고급_매핑/joined_table.png" alt="img" data-proofer-ignore></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>    <span class="nd">@Entity</span>
    <span class="nd">@Inheritance</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">InheritanceType</span><span class="o">.</span><span class="na">JOINED</span><span class="o">)</span> 
    <span class="nd">@DiscriminatorColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"DTYPE"</span><span class="o">)</span> <span class="c1">// 구분 컬럼 지정</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="o">{</span>
    
        <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
        <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ITEM_ID"</span><span class="o">)</span>
        <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    
        <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>        <span class="c1">//이름</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">price</span><span class="o">;</span>          <span class="c1">//가격</span>
        <span class="o">...</span>
    <span class="o">}</span>

    <span class="nd">@Entity</span>
    <span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="s">"B"</span><span class="o">)</span> <span class="c1">// 구분 컬럼에 입력할 값을 지정</span>
    <span class="nd">@PrimaryKeyJoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"BOOK_ID"</span><span class="o">)</span> <span class="c1">// ID 재정의</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="kd">extends</span> <span class="nc">Item</span> <span class="o">{</span>
    
        <span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>
        <span class="kd">private</span> <span class="nc">String</span> <span class="n">isbn</span><span class="o">;</span>
        <span class="o">...</span>
    <span class="o">}</span>
</pre></table></code></div></div><p><a id="org590a6cd"></a></p><h3 id="장점"><span class="mr-2">장점</span><a href="#장점" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>테이블이 정규화<li>외래 키 참조 무결성 제약조건을 활용<li>저장공간을 효율적 사용</ul><p><a id="orgc441028"></a></p><h3 id="단점"><span class="mr-2">단점</span><a href="#단점" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>조인을 많이 사용, 성능 저하<li>쿼리가 복잡<li>데이터 등록 시, INSERT SQL을 두 번 실행</ul><p><a id="org17e1f8d"></a></p><h3 id="특징"><span class="mr-2">특징</span><a href="#특징" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>몇몇 구현체는 구분 컬럼 없이도 동작한다.</ul><p><a id="org655c921"></a></p><h2 id="단일-테이블-전략"><span class="mr-2">단일 테이블 전략</span><a href="#단일-테이블-전략" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>테이블을 하나만 사용<br /> 구분 컬럼(DTYPE)으로 어떤 자식 데이터가 저장되었는지 구분<br /> 조회할 때 조인을 사용하지 않으므로 일반적으로 가장 빠르다.</p><p><img data-src="/assets/img/고급_매핑/single_table.png" alt="img" data-proofer-ignore></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>    <span class="nd">@Entity</span>
    <span class="nd">@Inheritance</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">InheritanceType</span><span class="o">.</span><span class="na">SINGLE_TABLE</span><span class="o">)</span>
    <span class="nd">@DiscriminatorColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"DTYPE"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="o">{</span>
    
        <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
        <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ITEM_ID"</span><span class="o">)</span>
        <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    
        <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>        <span class="c1">//이름</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">price</span><span class="o">;</span>          <span class="c1">//가격</span>
        <span class="o">...</span>
    <span class="o">}</span>

    <span class="nd">@Entity</span>
    <span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="s">"A"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Album</span> <span class="kd">extends</span> <span class="nc">Item</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
    
    <span class="nd">@Entity</span>
    <span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="s">"B"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="kd">extends</span> <span class="nc">Item</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
    
    <span class="nd">@Entity</span>
    <span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="s">"M"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Movie</span> <span class="kd">extends</span> <span class="nc">Item</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</pre></table></code></div></div><p><a id="org513b7f3"></a></p><h3 id="장점-1"><span class="mr-2">장점</span><a href="#장점-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>조회 성능이 빠르다<li>쿼리가 단순</ul><p><a id="orgbfe0397"></a></p><h3 id="단점-1"><span class="mr-2">단점</span><a href="#단점-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>자식 엔티티가 매핑한 컬럼은 모두 null을 허용<li>테이블이 커질 수 있어서 상황에 따라서는 조회 성능이 오히려 느려질 수 있다.</ul><p><a id="org970d7c5"></a></p><h3 id="특징-1"><span class="mr-2">특징</span><a href="#특징-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>구분 컬럼을 꼭 사용 @DiscriminatorColumn을 꼭 설정<li>@DiscriminatorValue을 지정하지 않으면 기본으로 엔티티 이름을 사용</ul><p><a id="orgde8a547"></a></p><h2 id="구현-클래스마다-테이블-전략"><span class="mr-2">구현 클래스마다 테이블 전략</span><a href="#구현-클래스마다-테이블-전략" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>자식 엔티티마다 테이블을 만든다. 그리고 자식 테이블 각각에 필요한 컬럼이 모두 있다.<br /> 데이터베이스 설계자와 ORM 전문가 둘 다 추천하지 않는 전략</p><p><img data-src="/assets/img/고급_매핑/concrete_table.png" alt="img" data-proofer-ignore></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>    <span class="nd">@Entity</span>
    <span class="nd">@Inheritance</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">InheritanceType</span><span class="o">.</span><span class="na">TABLE_PER_CLASS</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="o">{</span>
    
        <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
        <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ITEM_ID"</span><span class="o">)</span>
        <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    
        <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>        <span class="c1">//이름</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">price</span><span class="o">;</span>          <span class="c1">//가격</span>
        <span class="o">...</span>
    <span class="o">}</span>

    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Album</span> <span class="kd">extends</span> <span class="nc">Item</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
    
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Movie</span> <span class="kd">extends</span> <span class="nc">Item</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
    
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="kd">extends</span> <span class="nc">Item</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</pre></table></code></div></div><p><a id="org6692670"></a></p><h3 id="장점-2"><span class="mr-2">장점</span><a href="#장점-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>서브 타입을 구분해서 처리할 때 효과적<li>not null 제약조건을 사용할 수 있다.</ul><p><a id="org6f3691e"></a></p><h3 id="단점-2"><span class="mr-2">단점</span><a href="#단점-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>여러 자식 테이블을 함께 조회할 때 성능이 느리다.<li>자식 테이블을 통합해서 쿼리하기 어렵다.</ul><p><a id="orgf23ef9c"></a></p><h3 id="특징-2"><span class="mr-2">특징</span><a href="#특징-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>구분 컬럼을 사용하지 않는다.</ul><p><a id="org931965f"></a></p><h1 id="mappedsuperclass">@MappedSuperclass</h1><p>지금까지 상속 관계 매핑은 부모 클래스와 자식 클래스 모두 데이터베이스 테이블과 매핑<br /> <strong>부모 클래스는 테이블과 매핑하지 않고</strong><br /> 부모 클래스를 상속 받는 <strong>자식 클래스에게 매핑 정보만 제공하고 싶으면</strong> @MappedSuperclass를 사용하면 된다.</p><p>실제 테이블과는 매핑되지 않지만, 매핑 정보를 상속할 목적으로만 사용<br /> 즉, 테이블과는 관계가 없고 단순히 엔티티가 공통으로 사용하는 매핑 정보를 모아주는 역활을 할 뿐이다.</p><p>부모로부터 물려받은 <strong>매핑 정보를 재정의</strong> 하려면 @AttributeOverrides나 @AttributeOverride를 사용<br /> <strong>연관관계를 재정의</strong> 하려면 @AssociationOverrides나 @AssociationOverride를 사용</p><p><img data-src="/assets/img/고급_매핑/MappedSuperclass 설명_2022-05-07_10-53-57.jpeg" alt="img" data-proofer-ignore></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>    <span class="nd">@MappedSuperclass</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">BaseEntity</span> <span class="o">{</span>
       <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
       <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span> <span class="o">{</span>
       <span class="c1">//ID 상속</span>
       <span class="c1">//NAME 상속</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Seller</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span> <span class="o">{</span>
       <span class="c1">//ID 상속</span>
       <span class="c1">//NAME 상속</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">shopName</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
</pre></table></code></div></div><ul><li>매핑 정보를 상속하기 위해 사용<li>@MappedSuperclass로 지정한 클래스는 엔티티가 아니므로 em.find()나 JPQL에서 사용할 수 없다.<li>BaseEntity는 직접 생성해서 사용할 일이 거의 없으므로 추상 클래스로 만드는 것을 권장</ul><p><a id="orgf08c43d"></a></p><h1 id="복합-키와-식별-관계-매핑">복합 키와 식별 관계 매핑</h1><p><a id="org49baaec"></a></p><h2 id="식별-관계-vs-비식별-관계"><span class="mr-2">식별 관계 vs 비식별 관계</span><a href="#식별-관계-vs-비식별-관계" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>데이터베이스 테이블 사이에 관계는 외래 키가 기본 키에 포함되는지 여부에 따라 식별 관계와 비식별 관계로 구분</p><p><a id="orgc7242db"></a></p><h3 id="식별-관계"><span class="mr-2">식별 관계</span><a href="#식별-관계" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>부모 테이블의 기본 키를 내려받아서 <strong>자식 테이블의 기본 키 + 외래 키로 사용</strong> 하는 관계</p><p><img data-src="/assets/img/고급_매핑/identifying_relationship.png" alt="img" data-proofer-ignore></p><p><a id="org5bec718"></a></p><h3 id="비식별-관계"><span class="mr-2">비식별 관계</span><a href="#비식별-관계" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>부모 테이블의 기본 키를 받아서 자식 테이블의 외래 키로만 사용하는 관계</p><p><strong>필수적 비식별 관계</strong></p><p><img data-src="/assets/img/고급_매핑/mandatory.png" alt="img" data-proofer-ignore></p><p><strong>선택적 비실별 관계</strong></p><p><img data-src="/assets/img/고급_매핑/optional.png" alt="img" data-proofer-ignore></p><ul><li>필수적 비식별 관계 : 외래 키에 NULL을 허용하지 않는다.<li>선택적 비식별 관계 : 외래 키에 NULL을 허용한다.</ul><p>최근에는 비식별 관계를 주로 사용하고 꼭 필요한 곳에만 식별 관계를 사용하는 추세</p><p><a id="orgccaecae"></a></p><h2 id="복합-키-비식별-관계-매핑"><span class="mr-2">복합 키: 비식별 관계 매핑</span><a href="#복합-키-비식별-관계-매핑" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>식벽자 필드가 2개 이상이면 별도의 식별자 클래스를 만들고 그곳에 equals와 hashCode를 구현해야 한다.<br /> JPA는 복합 키를 지원하기 위해 @IdClass와 @EmbeddedId 2가지 방법을 제공<br /> @IdClass는 관계형 데이터베이스에 가까운 방법<br /> @EmbeddedId는 좀 더 객체지향에 가까운 방법</p><p><a id="org2274c90"></a></p><h3 id="idclass"><span class="mr-2">@IdClass</span><a href="#idclass" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>데이터베이스에 가까운 방법</p><p><img data-src="/assets/img/고급_매핑/IdClass_table.png" alt="img" data-proofer-ignore></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>    <span class="nd">@Entity</span>
    <span class="nd">@IdClass</span> <span class="o">(</span><span class="nc">ParentId</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
       <span class="nd">@Id</span>
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID1"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">id1</span><span class="o">;</span> <span class="c1">// ParentId.id1과 연결</span>
    
       <span class="nd">@Id</span>
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID2"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">id2</span><span class="o">;</span> <span class="c1">// ParentId.id2와 연결</span>
    
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">ParentId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">id1</span><span class="o">;</span> <span class="c1">// Parent.id1 매핑</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">id2</span><span class="o">;</span> <span class="c1">// Parent.id2 매핑</span>
       <span class="o">...</span>
    <span class="o">}</span>
</pre></table></code></div></div><p>@IdClass를 사용할 때 식별자 클래스는 다음 조건을 만족해야 한다.</p><ul><li>식별자 클래스의 속성명과 엔티티에서 사용하는 식별자의 속성명이 같아야 한다.<li>Serializable 인터페이스를 구현<li>equals, hashCode를 구현<li><p>식별자 클래스는 public이어야 한다.</p><p>Parent parent = new Parent(); parent.setId1(“myId1”); parent.setId2(“myId2”); parent.setName(“parentName”); em.persist(parent);</p></ul><p>위의 코드를 보면 식별자 클래스 ParentId가 보이지 않는다.<br /> em.persist를 호출하면 영속성 컨텍스트에 엔티티를 등록하기 직전에 내부에서 Parent.id1, Parent.id2 값을 사용해서 식별자 클래스인 ParentId를 생성하고 영속성 컨텍스트의 키로 사용</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>    <span class="nc">ParentId</span> <span class="n">parentId</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ParentId</span><span class="o">(</span><span class="s">"myId1"</span><span class="o">,</span> <span class="s">"myId2"</span><span class="o">);</span>
    <span class="nc">Parent</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Parent</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">parentId</span><span class="o">);</span>
</pre></table></code></div></div><p>조회 코드를 보면 식별자 클래스인 ParentId를 사용해서 엔티티를 조회한다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
       <span class="nd">@Id</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>
    
       <span class="nd">@ManyToOne</span>
       <span class="nd">@JoinColumns</span><span class="o">({</span>
          <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID1"</span><span class="o">,</span>
             <span class="n">referenceColumnName</span> <span class="o">=</span> <span class="s">"PARENT_ID1"</span><span class="o">),</span>
          <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID2"</span><span class="o">,</span>
             <span class="n">referenceColumnName</span> <span class="o">=</span> <span class="s">"PARENT_ID2"</span><span class="o">)</span>
       <span class="o">})</span>
       <span class="kd">private</span> <span class="nc">Parent</span> <span class="n">parent</span><span class="o">;</span>
    <span class="o">}</span>
</pre></table></code></div></div><p><a id="orgf80d8fc"></a></p><h3 id="embeddedid"><span class="mr-2">@EmbeddedId</span><a href="#embeddedid" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>좀 더 객체지향적인 방법</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
       <span class="nd">@EmbeddedId</span>
       <span class="kd">private</span> <span class="nc">ParentId</span> <span class="n">id</span><span class="o">;</span>
    
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="nd">@Embeddable</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">ParentId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID1"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">id1</span><span class="o">;</span>
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID2"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">id2</span><span class="o">;</span>
    
       <span class="c1">// equals and hashCode 구현</span>
       <span class="o">...</span>
    <span class="o">}</span>
</pre></table></code></div></div><p>식별자 클래스를 기본키로 직접 매핑한다.<br /> @EmbebbedId를 적용한 식별자 클래스는 다음 조건을 만족해야 한다.</p><ul><li>@Embeddable 붙여주어야 한다.<li>Serializable 인터페이스를 구현<li>equals, hashCode를 구현<li>식별자 클래스는 public이어야 한다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>    <span class="c1">// 저장</span>
    <span class="nc">Parent</span> <span class="n">parent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Parent</span><span class="o">();</span>
    <span class="nc">ParentId</span> <span class="n">parentId</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ParentId</span><span class="o">(</span><span class="s">"myId1"</span><span class="o">,</span> <span class="s">"myId2"</span><span class="o">);</span>
    <span class="n">parent</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">parentId</span><span class="o">);</span>
    <span class="n">parent</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"parentName"</span><span class="o">);</span>
    <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">parent</span><span class="o">);</span>
    
    <span class="c1">// 조회</span>
    <span class="nc">ParentId</span> <span class="n">parentId</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ParentId</span><span class="o">(</span><span class="s">"myId1"</span><span class="o">,</span> <span class="s">"myId2"</span><span class="o">);</span>
    <span class="nc">Parent</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Parent</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">parentId</span><span class="o">);</span>
</pre></table></code></div></div><p><a id="org779cfed"></a></p><h3 id="idclass-vs-embeddabledid"><span class="mr-2">@IdClass vs @EmbeddabledId</span><a href="#idclass-vs-embeddabledid" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>각각 장단점이 있으므로 본인의 취향에 맞는 것을 일관성 있게 사용하면 된다.<br /> @EmbeddabledId가 더 객체지향적이고 중복도 없어서 좋아보이긴 하지만 특정 상황에 JPQL이 조금 더 길어질 수 있다.</p><p><a id="orgaf011be"></a></p><h2 id="복합-키-식별-관계-매핑"><span class="mr-2">복합 키: 식별 관계 매핑</span><a href="#복합-키-식별-관계-매핑" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="/assets/img/고급_매핑/identifying_relationship.png" alt="img" data-proofer-ignore></p><p><a id="org78f3d49"></a></p><h3 id="idclass와-식별관계"><span class="mr-2">@IdClass와 식별관계</span><a href="#idclass와-식별관계" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre><td class="rouge-code"><pre>    <span class="c1">// 부모</span>
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
       <span class="nd">@Id</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="c1">// 자식</span>
    <span class="nd">@Entity</span>
    <span class="nd">@IdClass</span><span class="o">(</span><span class="nc">ChildId</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
       <span class="nd">@Id</span>
       <span class="nd">@ManyToOne</span>
       <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">)</span>
       <span class="kd">public</span> <span class="nc">Parent</span> <span class="n">parent</span><span class="o">;</span>
    
       <span class="nd">@Id</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">childId</span><span class="o">;</span>
    
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="c1">// 자식 ID</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">ChildId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">parent</span><span class="o">;</span> <span class="c1">// Child.parent 매핑</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">childId</span><span class="o">;</span> <span class="c1">// Child.childId 매핑</span>
    
       <span class="c1">// equals, hashCode</span>
       <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="c1">// 손자</span>
    <span class="nd">@Entity</span>
    <span class="nd">@IdClass</span><span class="o">(</span><span class="nc">GrandChildId</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">GrandChild</span> <span class="o">{</span>
       <span class="nd">@Id</span>
       <span class="nd">@ManyToOne</span>
       <span class="nd">@JoinColumns</span><span class="o">({</span>
          <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">),</span>
          <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">)</span>
       <span class="o">})</span>
       <span class="kd">private</span> <span class="nc">Child</span> <span class="n">child</span><span class="o">;</span>
    
       <span class="nd">@Id</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"GRANDCHILD_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>
    
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="c1">// 손자 ID</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">GrandChild</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
       <span class="kd">private</span> <span class="nc">ChildId</span> <span class="n">child</span><span class="o">;</span> <span class="c1">// GrandChild.child 매핑</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span> <span class="c1">// GrandChild.id 매핑</span>
    
       <span class="c1">// equals, hashCode</span>
       <span class="o">...</span>
    <span class="o">}</span>
</pre></table></code></div></div><p><a id="org8131d4f"></a></p><h3 id="embeddabledid와-식별-관계"><span class="mr-2">@EmbeddabledId와 식별 관계</span><a href="#embeddabledid와-식별-관계" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>식별 관계를 구성할 때는 @MapsId를 사용해야 한다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre><td class="rouge-code"><pre>    <span class="c1">// 부모</span>
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
       <span class="nd">@Id</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
       <span class="nd">@EmbeddedId</span>
       <span class="kd">public</span> <span class="nc">ChildId</span> <span class="n">id</span><span class="o">;</span>
    
       <span class="nd">@MapsId</span><span class="o">(</span><span class="s">"parentId"</span><span class="o">)</span> <span class="c1">// ChildId.parentId 매핑</span>
       <span class="nd">@ManyToOne</span>
       <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">)</span>
       <span class="kd">public</span> <span class="nc">Parent</span> <span class="n">parent</span><span class="o">;</span>
    
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="c1">// 자식 ID</span>
    <span class="nd">@Embeddable</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">ChildId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">parentId</span><span class="o">;</span> <span class="c1">// @MapsId("parentId")로 매핑</span>
    
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>
    
       <span class="c1">// equals, hashCode</span>
       <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="c1">// 손자</span>
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">GrandChild</span> <span class="o">{</span>
       <span class="nd">@EmbeddedId</span>
       <span class="kd">private</span> <span class="nc">GrandChildId</span> <span class="n">id</span><span class="o">;</span>
    
       <span class="nd">@MapsId</span><span class="o">(</span><span class="s">"childId"</span><span class="o">)</span> <span class="c1">// GrandChildId.childId 매핑</span>
       <span class="nd">@ManyToOne</span>
       <span class="nd">@JoinColumns</span><span class="o">({</span>
          <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">),</span>
          <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">)</span>
       <span class="o">})</span>
       <span class="kd">private</span> <span class="nc">Child</span> <span class="n">child</span><span class="o">;</span>
    
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="c1">// 손자 ID</span>
    <span class="nd">@Embeddable</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">GrandChild</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
       <span class="kd">private</span> <span class="nc">ChildId</span> <span class="n">childId</span><span class="o">;</span> <span class="c1">// @MapsId("childId")로 매핑</span>
    
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"GRANDCHILD_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>
    
       <span class="c1">// equals, hashCode</span>
       <span class="o">...</span>
    <span class="o">}</span>
</pre></table></code></div></div><p>@MapsId는 외래키와 매핑한 연관관계를 기본 키에도 매핑하겠다는 뜻이다.</p><p><a id="org462cee1"></a></p><h2 id="비식별-관계로-구현"><span class="mr-2">비식별 관계로 구현</span><a href="#비식별-관계로-구현" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="/assets/img/고급_매핑/optional_relationship_impl.png" alt="img" data-proofer-ignore></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre>    <span class="c1">// 부모</span>
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
       <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="c1">// 자식</span>
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
       <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    
       <span class="nd">@ManyToOne</span>
       <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">Parent</span> <span class="n">parent</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="c1">// 손자</span>
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">GrandChild</span> <span class="o">{</span>
       <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"GRANDCHILD_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    
       <span class="nd">@ManyToOne</span>
       <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">Child</span> <span class="n">child</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
</pre></table></code></div></div><p><a id="orgd73e6a2"></a></p><h2 id="일대일-식별-관계"><span class="mr-2">일대일 식별 관계</span><a href="#일대일-식별-관계" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="/assets/img/고급_매핑/optional_1_1.png" alt="img" data-proofer-ignore></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre>    <span class="c1">// 부모</span>
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Board</span> <span class="o">{</span>
       <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"BOARD_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
    
       <span class="nd">@OneToOne</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"board"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">BoardDetail</span> <span class="n">boardDetail</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">BoardDetail</span> <span class="o">{</span>
       <span class="nd">@Id</span>
       <span class="kd">private</span> <span class="nc">Long</span> <span class="n">boardId</span><span class="o">;</span>
    
       <span class="nd">@MapsId</span> <span class="c1">//BoardDetail.boardId 매핑</span>
       <span class="nd">@OneToOne</span>
       <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"BOARD_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">Board</span> <span class="n">board</span><span class="o">;</span>
    
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
</pre></table></code></div></div><p><a id="org0c2a576"></a></p><h2 id="식별-비식별-관계의-장단점"><span class="mr-2">식별, 비식별 관계의 장단점</span><a href="#식별-비식별-관계의-장단점" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>식별 관계는 부모 테이블의 기본 키를 자식 테이블로 전파하면서 자식 테이블의 기본 키 컬럼이 점점 늘어난다.<li>식별 관계는 2개 이상의 컬럼을 합해서 복합 기본 키를 만들어야 하는 경우가 많다.<li>식별 관계를 사용할 때 기본 키로 비즈니스 의미가 있는 자연 키 컬럼을 조합하는 경우가 많다.<br /> 비식별 관계는 키본 키를 비즈니스와 전혀 관계없는 대리 키를 주로 사용<br /> 식별 관계의 자연 키 컬럼들이 자식에 손자까지 전파되면 변경하기 힘들다.<li>식별 관계는 비식별 관계보다 테이블 구조가 유연하지 못 하다.<br /> 이와 같은 이유로 객체 관계 매핑 관점에서 비식별 관계를 선호<li>일대일 관계를 제외하고 식별 관계는 2개 이상의 컬럼을 묶은 복합 기본키를 사용한다.<li>비식별 관계는 주로 대리키를 사용하여 @GeneratedValue처럼 대리 키를 생성하기 위한 편리한 방법을 제공<li>식별 관계의 장점으로 기본 키 인덱스를 활용하기 좋고, 특정 상황에 조인 없이 하위 테이블만으로 검색을 완료할 수 있다.</ul><p>비식별관계를 사용하고 기본 키는 Long 타입의 대리 키를 사용하는 것을 추천<br /> 추가적으로 선택적 비식별 관계보다는 필수적 비식별 관계를 사용하는 것이 좋다.</p><p><a id="orga69d623"></a></p><h1 id="조인-테이블">조인 테이블</h1><p>테이블 연관관계를 설계하는 방법은 크게 2가지다.</p><ul><li>조인 컬럼 사용<li>조인 테이블 사용</ul><p>조인 컬럼을 사용하고 필요하다고 판단되면 조인 테이블을 사용하자</p><p><a id="orgea71808"></a></p><h2 id="일대일-조인-테이블"><span class="mr-2">일대일 조인 테이블</span><a href="#일대일-조인-테이블" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="/assets/img/고급_매핑/jointable_1_1.png" alt="img" data-proofer-ignore></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>    <span class="c1">// 부모</span>
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
       <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    
       <span class="nd">@OneToOne</span>
       <span class="nd">@JoinTable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_CHILD"</span><span class="o">,</span>
                  <span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">),</span>
                  <span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">))</span>
       <span class="kd">private</span> <span class="nc">Child</span> <span class="n">child</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="c1">// 자식</span>
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
       <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    
       <span class="nd">@OneToOne</span><span class="o">(</span><span class="n">mappedBy</span><span class="o">=</span><span class="s">"child"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">Parent</span> <span class="n">parent</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
</pre></table></code></div></div><p><a id="org30b303f"></a></p><h2 id="일대다-조인-테이블"><span class="mr-2">일대다 조인 테이블</span><a href="#일대다-조인-테이블" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="/assets/img/고급_매핑/jointable_1_many.png" alt="img" data-proofer-ignore></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>    <span class="c1">// 부모</span>
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
       <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    
       <span class="nd">@OneToMany</span>
       <span class="nd">@JoinTable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_CHILD"</span><span class="o">,</span>
                  <span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">),</span>
                  <span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">))</span>
       <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Child</span><span class="o">&gt;</span> <span class="n">child</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Child</span><span class="o">&gt;();</span>
       <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="c1">// 자식</span>
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
       <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
</pre></table></code></div></div><p><a id="org16fcb7d"></a></p><h2 id="다대일-조인-테이블"><span class="mr-2">다대일 조인 테이블</span><a href="#다대일-조인-테이블" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>다대일은 일대다에서 방향만 반대</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>    <span class="c1">// 부모</span>
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
       <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    
       <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"parent"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Child</span><span class="o">&gt;</span> <span class="n">child</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Child</span><span class="o">&gt;();</span>
       <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="c1">// 자식</span>
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
       <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    
       <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">optional</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
       <span class="nd">@JoinTable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_CHILD"</span><span class="o">,</span>
                  <span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">),</span>
                  <span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">))</span>
       <span class="kd">private</span> <span class="nc">Parent</span> <span class="n">parent</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
</pre></table></code></div></div><p><a id="org25356d9"></a></p><h2 id="다대다-조인-테이블"><span class="mr-2">다대다 조인 테이블</span><a href="#다대다-조인-테이블" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="/assets/img/고급_매핑/jointable_many_many.png" alt="img" data-proofer-ignore></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>    <span class="c1">// 부모</span>
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
       <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    
       <span class="nd">@ManyToMany</span>
       <span class="nd">@JoinTable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_CHILD"</span><span class="o">)</span>
                  <span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">),</span>
                  <span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">))</span>
       <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Child</span><span class="o">&gt;</span> <span class="n">child</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Child</span><span class="o">&gt;();</span>
       <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="c1">// 자식</span>
    <span class="nd">@Entity</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
       <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
</pre></table></code></div></div><p><a id="org989aae8"></a></p><h1 id="엔티티-하나에-여러-테이블-매핑">엔티티 하나에 여러 테이블 매핑</h1><p><img data-src="/assets/img/고급_매핑/one_entity_mapping_multi_table_2022-05-07_11-17-48.jpeg" alt="img" data-proofer-ignore></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>    <span class="nd">@Entity</span>
    <span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"BOARD"</span><span class="o">)</span>
    <span class="nd">@SecondaryTable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"BOARD_DETAIL"</span><span class="o">,</span>
                    <span class="n">pkJoinColumns</span> <span class="o">=</span> <span class="nd">@PrimaryKeyJoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"BOARD_DETAIL_ID"</span><span class="o">))</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Board</span> <span class="o">{</span>
       <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
       <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"BOARD_ID"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
    
       <span class="nd">@Column</span><span class="o">(</span><span class="n">table</span> <span class="o">=</span> <span class="s">"BOARD_DETAIL"</span><span class="o">)</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>
       <span class="o">...</span>
    <span class="o">}</span>
</pre></table></code></div></div><ul><li>@SecondaryTable.name: 매핑할 다른 테이블의 이름<li>@SecondaryTable.pkJoinColumns: 매핑할 다른 테이블의 기본 키 컬럼 속성<li>content 필드는 @Column(table = “BOARD<sub>DETAIL</sub>“)을 사용해 BOARD<sub>DETAIL</sub> 테이블의 컬럼에 매핑<li>더 많은 테이블에 매핑하려면 @SecondaryTables를 사용</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>        <span class="nd">@SecondaryTables</span><span class="o">({</span>
           <span class="nd">@SecondaryTable</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"BOARD_DETAIL"</span><span class="o">),</span>
           <span class="nd">@SecondaryTable</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"BOARD_FILE"</span><span class="o">)</span>
        <span class="o">})</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/study/'>Study</a>, <a href='/categories/book/'>Book</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/jpa/" class="post-tag no-text-decoration" >JPA</a> <a href="/tags/orm/" class="post-tag no-text-decoration" >ORM</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=자바 ORM 표준 JPA 프로그래밍 - 고급 매핑 - Appchemist&amp;url=https://appchemist.github.io/posts/%EC%9E%90%EB%B0%94_orm_%ED%91%9C%EC%A4%80_jpa_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D_%EA%B3%A0%EA%B8%89_%EB%A7%A4%ED%95%91/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=자바 ORM 표준 JPA 프로그래밍 - 고급 매핑 - Appchemist&amp;u=https://appchemist.github.io/posts/%EC%9E%90%EB%B0%94_orm_%ED%91%9C%EC%A4%80_jpa_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D_%EA%B3%A0%EA%B8%89_%EB%A7%A4%ED%95%91/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://appchemist.github.io/posts/%EC%9E%90%EB%B0%94_orm_%ED%91%9C%EC%A4%80_jpa_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D_%EA%B3%A0%EA%B8%89_%EB%A7%A4%ED%95%91/&amp;text=자바 ORM 표준 JPA 프로그래밍 - 고급 매핑 - Appchemist" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/DDIA-CH6/">DDIA - 파티셔닝</a><li><a href="/posts/DDIA-CH4/">DDIA - 부호화와_발전</a><li><a href="/posts/clean_architecture_ch20/">클린 아키텍처 - 업무 규칙</a><li><a href="/posts/clean_architecture_ch17/">클린 아키텍처 - 경계 선 긋기</a><li><a href="/posts/DDIA-CH1/">DDIA - 신뢰할 수 있고 확장 가능하며 유지보수하기 쉬운 애플리케이션</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/architecture/">architecture</a> <a class="post-tag" href="/tags/clean-architecture/">clean architecture</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/orm/">ORM</a> <a class="post-tag" href="/tags/c/">c++</a> <a class="post-tag" href="/tags/applicationn/">Applicationn</a> <a class="post-tag" href="/tags/data/">Data</a> <a class="post-tag" href="/tags/system/">System</a> <a class="post-tag" href="/tags/efficient-c/">Efficient C++</a> <a class="post-tag" href="/tags/performance/">Performance</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/%EC%9E%90%EB%B0%94_orm_%ED%91%9C%EC%A4%80_jpa_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D_JPA-%EC%86%8C%EA%B0%9C/"><div class="card-body"> <em class="timeago small" data-ts="1618066800" > 2021-04-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>자바 ORM 표준 JPA 프로그래밍 - JPA 소개</h3><div class="text-muted small"><p> Table of Contents JPA 소개 SQL을 직접 다룰 때 발생하는 문제점 반복, 반복 그리고 반복 SQL에 의존적인 개발 패러다임의 불일치 JPA란 무엇인가? JAP 소개 ...</p></div></div></a></div><div class="card"> <a href="/posts/%EC%9E%90%EB%B0%94_orm_%ED%91%9C%EC%A4%80_jpa_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D_JPA-%EC%8B%9C%EC%9E%91/"><div class="card-body"> <em class="timeago small" data-ts="1618153200" > 2021-04-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>자바 ORM 표준 JPA 프로그래밍 - JPA 시작</h3><div class="text-muted small"><p> Table of Contents JPA 시작 객체 매핑 시작 persistence.xml 설정 데이터베이스 방언 애플리케이션 개발 엔티티 매니저 생성 트랜잭션 관리 비즈니스...</p></div></div></a></div><div class="card"> <a href="/posts/%EC%9E%90%EB%B0%94_orm_%ED%91%9C%EC%A4%80_jpa_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D_%EC%98%81%EC%86%8D%EC%84%B1-%EA%B4%80%EB%A6%AC/"><div class="card-body"> <em class="timeago small" data-ts="1618671600" > 2021-04-18 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>자바 ORM 표준 JPA 프로그래밍 - 영속성 관리</h3><div class="text-muted small"><p> Table of Contents 영속성 관리 엔티티 매니저 팩토리와 엔티티 매니저 영속성 컨텍스트란? 엔티티 생명주기 영속성 컨텍스트의 특징 엔티티 조회 엔티티 등록 엔티티 수정 엔티티 삭제 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/%EC%9E%90%EB%B0%94_orm_%ED%91%9C%EC%A4%80_jpa_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D_%EB%8B%A4%EC%96%91%ED%95%9C-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91/" class="btn btn-outline-primary" prompt="Older"><p>자바 ORM 표준 JPA 프로그래밍 - 다양한 연관관계 매핑</p></a> <a href="/posts/%EC%9E%90%EB%B0%94_orm_%ED%91%9C%EC%A4%80_jpa_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D_%ED%94%84%EB%A1%9D%EC%8B%9C%EC%99%80_%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84_%EA%B4%80%EB%A6%AC/" class="btn btn-outline-primary" prompt="Newer"><p>자바 ORM 표준 JPA 프로그래밍 - 프록시와 연관관계 관리</p></a></div><script src="https://utteranc.es/client.js" repo="appchemist/appchemist.github.io" issue-term="url" crossorigin="anonymous" async> </script> <script type="text/javascript"> $(function() { const origin = "https://utteranc.es"; const iframe = "iframe.utterances-frame"; const lightTheme = "github-light"; const darkTheme = "github-dark"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } addEventListener("message", (event) => { let theme; /* credit to <https://github.com/utterance/utterances/issues/170#issuecomment-594036347> */ if (event.origin === origin) { /* page initial */ theme = initTheme; } else if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); } else { return; } const message = { type: "set-theme", theme: theme }; const utterances = document.querySelector(iframe).contentWindow; utterances.postMessage(message, origin); }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/appchemist">appchemist</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/architecture/">architecture</a> <a class="post-tag" href="/tags/clean-architecture/">clean architecture</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/orm/">ORM</a> <a class="post-tag" href="/tags/c/">c++</a> <a class="post-tag" href="/tags/applicationn/">Applicationn</a> <a class="post-tag" href="/tags/data/">Data</a> <a class="post-tag" href="/tags/system/">System</a> <a class="post-tag" href="/tags/efficient-c/">Efficient C++</a> <a class="post-tag" href="/tags/performance/">Performance</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-KEPDM82EY9"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-KEPDM82EY9'); }); </script>
