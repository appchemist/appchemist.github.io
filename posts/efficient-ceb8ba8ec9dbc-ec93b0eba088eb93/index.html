<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="EFFICIENT C++_단일 쓰레드 메모리 풀링" /><meta property="og:locale" content="en" /><meta name="description" content="메모리를 자주 할당하고 해지하는 것은 응용프로그램 성능을 저하시키는 주요한 요소이다. 성능 저하는 기본 메모리 관리자가 일반적인 목적을 가지고 있기 때문에 발생한다. 특화된 메모리 관리자를 개발하여 이러한 사항을 극복할 수 있다. 이러한 메모리 관리자를 개발하고자 할때, 메모리의 크기와 동시성이라는 문제를 생각해야 한다. 메모리 크기는 다음 2가지를 생각할 수 있다. 고정 크기 – 고정 크기의 메모리 블록을 할당 가변 크기 – 다양한 크기의 메모리 블록을 할당 동시성에서도 2가지를 생각할 수 있다. 단일 쓰레드 – 하나의 쓰레드가 메모리 관리자를 사용 멀티 쓰레드 – 여러 쓰레드가 메모리 관리자를 사용 이렇게 메모리 관리자는 4버전으로 만들 수 있다. 이번에는 단일 쓰레드 차원에서 메모리 관리자간의 성능을 확인해 보자. 버전 0: 전역 new()와 delete() 기본 메모리 관리자는 일반적인 역활을 수행한다. 기본 메모리 관리자는 전역 new()와 delete()를 호출할 때 사용이 된다. 기본 메모리 관리자는 멀티쓰레드 환경에서 작동할 수 있다. 더불어 메모리 크기는 요청이 발생할 때마다 변할 수 있다. 이러한 유연성은 속도와 절충된다. 클라이언트 코드가 전역 new()와 delete()의 전 기능이 필요하지 않는 경우가 있다. 이런 경우, 해당 함수의 전 기능을 사용하는것은 CPU 주기 낭비이다. 아래는 전역 new와 delete를 사용한 코드이다." /><meta property="og:description" content="메모리를 자주 할당하고 해지하는 것은 응용프로그램 성능을 저하시키는 주요한 요소이다. 성능 저하는 기본 메모리 관리자가 일반적인 목적을 가지고 있기 때문에 발생한다. 특화된 메모리 관리자를 개발하여 이러한 사항을 극복할 수 있다. 이러한 메모리 관리자를 개발하고자 할때, 메모리의 크기와 동시성이라는 문제를 생각해야 한다. 메모리 크기는 다음 2가지를 생각할 수 있다. 고정 크기 – 고정 크기의 메모리 블록을 할당 가변 크기 – 다양한 크기의 메모리 블록을 할당 동시성에서도 2가지를 생각할 수 있다. 단일 쓰레드 – 하나의 쓰레드가 메모리 관리자를 사용 멀티 쓰레드 – 여러 쓰레드가 메모리 관리자를 사용 이렇게 메모리 관리자는 4버전으로 만들 수 있다. 이번에는 단일 쓰레드 차원에서 메모리 관리자간의 성능을 확인해 보자. 버전 0: 전역 new()와 delete() 기본 메모리 관리자는 일반적인 역활을 수행한다. 기본 메모리 관리자는 전역 new()와 delete()를 호출할 때 사용이 된다. 기본 메모리 관리자는 멀티쓰레드 환경에서 작동할 수 있다. 더불어 메모리 크기는 요청이 발생할 때마다 변할 수 있다. 이러한 유연성은 속도와 절충된다. 클라이언트 코드가 전역 new()와 delete()의 전 기능이 필요하지 않는 경우가 있다. 이런 경우, 해당 함수의 전 기능을 사용하는것은 CPU 주기 낭비이다. 아래는 전역 new와 delete를 사용한 코드이다." /><link rel="canonical" href="https://appchemist.github.io/posts/efficient-ceb8ba8ec9dbc-ec93b0eba088eb93/" /><meta property="og:url" content="https://appchemist.github.io/posts/efficient-ceb8ba8ec9dbc-ec93b0eba088eb93/" /><meta property="og:site_name" content="Appchemist" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2016-07-18T09:49:54+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="EFFICIENT C++_단일 쓰레드 메모리 풀링" /><meta name="twitter:site" content="@appchemist" /><meta name="google-site-verification" content="ayKW7N1F1Lf9GFGDgfNENpw486FaeJYvFrGByBGAGEI" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2016-07-18T09:49:54+09:00","datePublished":"2016-07-18T09:49:54+09:00","description":"메모리를 자주 할당하고 해지하는 것은 응용프로그램 성능을 저하시키는 주요한 요소이다. 성능 저하는 기본 메모리 관리자가 일반적인 목적을 가지고 있기 때문에 발생한다. 특화된 메모리 관리자를 개발하여 이러한 사항을 극복할 수 있다. 이러한 메모리 관리자를 개발하고자 할때, 메모리의 크기와 동시성이라는 문제를 생각해야 한다. 메모리 크기는 다음 2가지를 생각할 수 있다. 고정 크기 – 고정 크기의 메모리 블록을 할당 가변 크기 – 다양한 크기의 메모리 블록을 할당 동시성에서도 2가지를 생각할 수 있다. 단일 쓰레드 – 하나의 쓰레드가 메모리 관리자를 사용 멀티 쓰레드 – 여러 쓰레드가 메모리 관리자를 사용 이렇게 메모리 관리자는 4버전으로 만들 수 있다. 이번에는 단일 쓰레드 차원에서 메모리 관리자간의 성능을 확인해 보자. 버전 0: 전역 new()와 delete() 기본 메모리 관리자는 일반적인 역활을 수행한다. 기본 메모리 관리자는 전역 new()와 delete()를 호출할 때 사용이 된다. 기본 메모리 관리자는 멀티쓰레드 환경에서 작동할 수 있다. 더불어 메모리 크기는 요청이 발생할 때마다 변할 수 있다. 이러한 유연성은 속도와 절충된다. 클라이언트 코드가 전역 new()와 delete()의 전 기능이 필요하지 않는 경우가 있다. 이런 경우, 해당 함수의 전 기능을 사용하는것은 CPU 주기 낭비이다. 아래는 전역 new와 delete를 사용한 코드이다.","headline":"EFFICIENT C++_단일 쓰레드 메모리 풀링","mainEntityOfPage":{"@type":"WebPage","@id":"https://appchemist.github.io/posts/efficient-ceb8ba8ec9dbc-ec93b0eba088eb93/"},"url":"https://appchemist.github.io/posts/efficient-ceb8ba8ec9dbc-ec93b0eba088eb93/"}</script><title>EFFICIENT C++_단일 쓰레드 메모리 풀링 | Appchemist</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Appchemist"><meta name="application-name" content="Appchemist"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://avatars.githubusercontent.com/u/1546031?v=4 " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Appchemist</a></div><div class="site-subtitle font-italic">Software Developer, Want to being a Developer likes alchemist.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/appchemist" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/appchemist" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['appchemist','hotmail.co.kr'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>EFFICIENT C++_단일 쓰레드 메모리 풀링</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>EFFICIENT C++_단일 쓰레드 메모리 풀링</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/appchemist">appchemist</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1468802994" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2016-07-18 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2506 words"> <em>13 min</em> read</span></div></div></div><div class="post-content"><p>메모리를 자주 할당하고 해지하는 것은 응용프로그램 성능을 저하시키는 주요한 요소이다. 성능 저하는 기본 메모리 관리자가 일반적인 목적을 가지고 있기 때문에 발생한다. 특화된 메모리 관리자를 개발하여 이러한 사항을 극복할 수 있다. 이러한 메모리 관리자를 개발하고자 할때, 메모리의 크기와 동시성이라는 문제를 생각해야 한다. 메모리 크기는 다음 2가지를 생각할 수 있다.</p><ul><li>고정 크기 – 고정 크기의 메모리 블록을 할당<li>가변 크기 – 다양한 크기의 메모리 블록을 할당 동시성에서도 2가지를 생각할 수 있다.<li>단일 쓰레드 – 하나의 쓰레드가 메모리 관리자를 사용<li>멀티 쓰레드 – 여러 쓰레드가 메모리 관리자를 사용 이렇게 메모리 관리자는 4버전으로 만들 수 있다. 이번에는 단일 쓰레드 차원에서 메모리 관리자간의 성능을 확인해 보자. <strong>버전 0: 전역 new()와 delete()</strong> 기본 메모리 관리자는 일반적인 역활을 수행한다. 기본 메모리 관리자는 전역 new()와 delete()를 호출할 때 사용이 된다. 기본 메모리 관리자는 멀티쓰레드 환경에서 작동할 수 있다. 더불어 메모리 크기는 요청이 발생할 때마다 변할 수 있다. 이러한 유연성은 속도와 절충된다. 클라이언트 코드가 전역 new()와 delete()의 전 기능이 필요하지 않는 경우가 있다. 이런 경우, 해당 함수의 전 기능을 사용하는것은 CPU 주기 낭비이다. 아래는 전역 new와 delete를 사용한 코드이다.</ul><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>    <span class="k">class</span> <span class="nc">Rational</span> <span class="p">{</span>
    <span class="nl">public:</span>
        <span class="n">Rational</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="n">n</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">d</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="nl">private:</span>
        <span class="kt">int</span> <span class="n">n</span><span class="p">;</span> <span class="c1">// 분자</span>
        <span class="kt">int</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// 분모</span>
    <span class="p">};</span>
</pre></table></code></div></div><p>Rational 클래스를 사용하여 전역 new(), delete()의 성능을 측정해보자. </p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="n">TEST</span><span class="p">(</span><span class="n">Chapter6</span><span class="p">,</span> <span class="n">Normal_NEW_DELETE</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Rational</span> <span class="o">*</span><span class="n">array</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">5000</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rational</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">delete</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>성능은 gtest에서 해당 테스트의 걸린 시간으로 측정했다. 약 2600 millisecond로 측정이 됐다. <strong>버전 1: Rational에 특화된 메모리 관리자</strong> 기본 메모리 관리자를 너무 자주 호출하는 것을 방지하기 위해서 Rational 클래스는 미리 할당된 Rational 객체들의 정적 연결 리스트로 유지한다.  새로운 Rational 객체가 필요하면, 해당 리스트에서 하나를 가져온다. 사용이 끝나면 이후에 사용할 수 있도록 이것을 리스트로 반환한다. </p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
</pre><td class="rouge-code"><pre>    <span class="k">class</span> <span class="nc">NextOnFreeList</span> <span class="p">{</span>
    <span class="nl">public:</span>
        <span class="n">NextOnFreeList</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="k">class</span> <span class="nc">RationalVer1</span> <span class="p">{</span>
    <span class="nl">private:</span>
        <span class="k">static</span> <span class="kt">void</span> <span class="n">expandTheFreeList</span><span class="p">();</span>

    <span class="nl">public:</span>
        <span class="n">RationalVer1</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="n">n</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">d</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

        <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span><span class="k">operator</span> <span class="k">new</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>
        <span class="kr">inline</span> <span class="kt">void</span> <span class="k">operator</span> <span class="k">delete</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">doomed</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>
        <span class="k">static</span> <span class="kt">void</span> <span class="n">newMemPool</span><span class="p">()</span> <span class="p">{</span> <span class="n">expandTheFreeList</span><span class="p">();</span> <span class="p">}</span>
        <span class="k">static</span> <span class="kt">void</span> <span class="n">deleteMemPool</span><span class="p">();</span>

    <span class="nl">private:</span>
        <span class="k">static</span> <span class="n">NextOnFreeList</span> <span class="o">*</span><span class="n">freeList</span><span class="p">;</span>

        <span class="k">enum</span> <span class="p">{</span> <span class="n">EXPASION_SIZE</span> <span class="o">=</span> <span class="mi">32</span> <span class="p">};</span>

        <span class="kt">int</span> <span class="n">n</span><span class="p">;</span> <span class="c1">// 분자</span>
        <span class="kt">int</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// 분모</span>
    <span class="p">};</span>

    <span class="kr">inline</span> <span class="kt">void</span><span class="o">*</span> <span class="n">RationalVer1</span><span class="o">::</span><span class="k">operator</span> <span class="nf">new</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">freeList</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">expandTheFreeList</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="n">NextOnFreeList</span> <span class="o">*</span><span class="n">head</span> <span class="o">=</span> <span class="n">freeList</span><span class="p">;</span>
        <span class="n">freeList</span> <span class="o">=</span> <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>

        <span class="k">return</span> <span class="n">head</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">RationalVer1</span><span class="o">::</span><span class="k">operator</span> <span class="nf">delete</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">doomed</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NextOnFreeList</span> <span class="o">*</span><span class="n">head</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">NextOnFreeList</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">doomed</span><span class="p">);</span>

        <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">freeList</span><span class="p">;</span>
        <span class="n">freeList</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">NextOnFreeList</span> <span class="o">*</span><span class="n">RationalVer1</span><span class="o">::</span><span class="n">freeList</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="kt">void</span> <span class="n">RationalVer1</span><span class="o">::</span><span class="n">expandTheFreeList</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">size_t</span> <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">RationalVer1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">NextOnFreeList</span> <span class="o">*</span><span class="p">))</span> <span class="o">?</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">RationalVer1</span><span class="p">)</span> <span class="o">:</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">NextOnFreeList</span> <span class="o">*</span><span class="p">);</span>

        <span class="n">NextOnFreeList</span> <span class="o">*</span><span class="n">runner</span> <span class="o">=</span> <span class="p">(</span><span class="n">NextOnFreeList</span> <span class="o">*</span><span class="p">)</span><span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>

        <span class="n">freeList</span> <span class="o">=</span> <span class="n">runner</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">EXPASION_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">runner</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="n">NextOnFreeList</span> <span class="o">*</span><span class="p">)</span><span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>
            <span class="n">runner</span> <span class="o">=</span> <span class="n">runner</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">runner</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">RationalVer1</span><span class="o">::</span><span class="n">deleteMemPool</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">NextOnFreeList</span> <span class="o">*</span><span class="n">nextPtr</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">nextPtr</span> <span class="o">=</span> <span class="n">freeList</span><span class="p">;</span> <span class="n">nextPtr</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">nextPtr</span> <span class="o">=</span> <span class="n">freeList</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">freeList</span> <span class="o">=</span> <span class="n">freeList</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
            <span class="k">delete</span> <span class="p">[]</span> <span class="n">nextPtr</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="p">}</span>
</pre></table></code></div></div><p>한번에 한 블록씩 할당 받지만 미리 받은 메모리 블록은 재활용한다는 점에서 버전 0과는 다른 점이다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="n">TEST</span><span class="p">(</span><span class="n">Chapter6</span><span class="p">,</span> <span class="n">VER1_NEW_DELETE</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">RationalVer1</span><span class="o">*</span><span class="n">array</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span>

    <span class="n">Rational</span><span class="o">::</span><span class="n">newMemPool</span><span class="p">();</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">5000</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RationalVer1</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">delete</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">Rational</span><span class="o">::</span><span class="n">deleteMemPool</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><p>이번 버전1의 경우 약 100 millisecond가 걸렸다. 기본 메모리 관리자에 비해서 약 26배 정도 속도 차이가 나는 것을 확인할 수 있다. <strong>버전 2: 고정 크기 객체 메모리 풀</strong> 이번에는 템플릿을 이용하여 관리하고자 하는 다양한 클래스를 관리할 수 있도록 작성할 것이다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
</pre><td class="rouge-code"><pre>    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">&gt;</span>
    <span class="k">class</span> <span class="nc">MemoryPool</span> <span class="p">{</span>
    <span class="nl">public:</span>
        <span class="n">MemoryPool</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span> <span class="o">=</span> <span class="n">EXPANSION_SIZE</span><span class="p">);</span>

        <span class="o">~</span><span class="n">MemoryPool</span><span class="p">();</span>

        <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span><span class="n">alloc</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>

        <span class="kr">inline</span> <span class="kt">void</span> <span class="n">free</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">someElement</span><span class="p">);</span>

    <span class="nl">private:</span>
        <span class="n">MemoryPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>

        <span class="k">enum</span> <span class="p">{</span>
            <span class="n">EXPANSION_SIZE</span> <span class="o">=</span> <span class="mi">32</span>
        <span class="p">};</span>

        <span class="kt">void</span> <span class="n">expandTheFreeList</span><span class="p">(</span><span class="kt">int</span> <span class="n">howMany</span> <span class="o">=</span> <span class="n">EXPANSION_SIZE</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">&gt;</span>
    <span class="kr">inline</span>
    <span class="kt">void</span><span class="o">*</span> <span class="n">MemoryPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">alloc</span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">next</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">expandTheFreeList</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="n">MemoryPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">head</span> <span class="o">=</span> <span class="n">next</span><span class="p">;</span>
        <span class="n">next</span> <span class="o">=</span> <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>

        <span class="k">return</span> <span class="n">head</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">&gt;</span>
    <span class="kr">inline</span>
    <span class="kt">void</span> <span class="n">MemoryPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">free</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">doomed</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">MemoryPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">head</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">MemoryPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">doomed</span><span class="p">);</span>

        <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">next</span><span class="p">;</span>
        <span class="n">next</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">&gt;</span>
    <span class="kt">void</span> <span class="n">MemoryPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">expandTheFreeList</span><span class="p">(</span><span class="kt">int</span> <span class="n">howMany</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">size_t</span> <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">&gt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">MemoryPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">*</span><span class="p">))</span> <span class="o">?</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">:</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">MemoryPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">*</span><span class="p">);</span>

        <span class="n">MemoryPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">runner</span> <span class="o">=</span> <span class="p">(</span><span class="n">MemoryPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">*</span><span class="p">)</span><span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>

        <span class="n">next</span> <span class="o">=</span> <span class="n">runner</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">howMany</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">runner</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="n">MemoryPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">*</span><span class="p">)</span><span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>
            <span class="n">runner</span> <span class="o">=</span> <span class="n">runner</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">runner</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span> <span class="p">&gt;</span>
    <span class="n">MemoryPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">MemoryPool</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">expandTheFreeList</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">&gt;</span>
    <span class="n">MemoryPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::~</span><span class="n">MemoryPool</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">MemoryPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">nextPtr</span> <span class="o">=</span> <span class="n">next</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(;</span> <span class="n">nextPtr</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">nextPtr</span> <span class="o">=</span> <span class="n">next</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">next</span> <span class="o">=</span> <span class="n">next</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
            <span class="k">delete</span> <span class="p">[]</span> <span class="n">nextPtr</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></table></code></div></div><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
</pre><td class="rouge-code"><pre>    <span class="k">class</span> <span class="nc">NextOnFreeList</span> <span class="p">{</span>
    <span class="nl">public:</span>
        <span class="n">NextOnFreeList</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="k">class</span> <span class="nc">RationalVer1</span> <span class="p">{</span>
    <span class="nl">private:</span>
        <span class="k">static</span> <span class="kt">void</span> <span class="n">expendTheFreeList</span><span class="p">();</span>

    <span class="nl">public:</span>
        <span class="n">RationalVer1</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="n">n</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">d</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

        <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span><span class="k">operator</span> <span class="k">new</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>
        <span class="kr">inline</span> <span class="kt">void</span> <span class="k">operator</span> <span class="k">delete</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">doomed</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>
        <span class="k">static</span> <span class="kt">void</span> <span class="n">newMemPool</span><span class="p">()</span> <span class="p">{</span> <span class="n">expendTheFreeList</span><span class="p">();</span> <span class="p">}</span>
        <span class="k">static</span> <span class="kt">void</span> <span class="n">deleteMemPool</span><span class="p">();</span>

    <span class="nl">private:</span>
        <span class="k">static</span> <span class="n">NextOnFreeList</span> <span class="o">*</span><span class="n">freeList</span><span class="p">;</span>

        <span class="k">enum</span> <span class="p">{</span> <span class="n">EXPASION_SIZE</span> <span class="o">=</span> <span class="mi">32</span> <span class="p">};</span>

        <span class="kt">int</span> <span class="n">n</span><span class="p">;</span> <span class="c1">// 분자</span>
        <span class="kt">int</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// 분모</span>
    <span class="p">};</span>

    <span class="kr">inline</span> <span class="kt">void</span><span class="o">*</span> <span class="n">RationalVer1</span><span class="o">::</span><span class="k">operator</span> <span class="nf">new</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">freeList</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">expendTheFreeList</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="n">NextOnFreeList</span> <span class="o">*</span><span class="n">head</span> <span class="o">=</span> <span class="n">freeList</span><span class="p">;</span>
        <span class="n">freeList</span> <span class="o">=</span> <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>

        <span class="k">return</span> <span class="n">head</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">RationalVer1</span><span class="o">::</span><span class="k">operator</span> <span class="nf">delete</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">doomed</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NextOnFreeList</span> <span class="o">*</span><span class="n">head</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">NextOnFreeList</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">doomed</span><span class="p">);</span>

        <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">freeList</span><span class="p">;</span>
        <span class="n">freeList</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">NextOnFreeList</span> <span class="o">*</span><span class="n">RationalVer1</span><span class="o">::</span><span class="n">freeList</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="kt">void</span> <span class="n">RationalVer1</span><span class="o">::</span><span class="n">expendTheFreeList</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">size_t</span> <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">RationalVer1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">NextOnFreeList</span> <span class="o">*</span><span class="p">))</span> <span class="o">?</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">RationalVer1</span><span class="p">)</span> <span class="o">:</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">NextOnFreeList</span> <span class="o">*</span><span class="p">);</span>

        <span class="n">NextOnFreeList</span> <span class="o">*</span><span class="n">runner</span> <span class="o">=</span> <span class="p">(</span><span class="n">NextOnFreeList</span> <span class="o">*</span><span class="p">)</span><span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>

        <span class="n">freeList</span> <span class="o">=</span> <span class="n">runner</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">EXPASION_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">runner</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="n">NextOnFreeList</span> <span class="o">*</span><span class="p">)</span><span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>
            <span class="n">runner</span> <span class="o">=</span> <span class="n">runner</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">runner</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">RationalVer1</span><span class="o">::</span><span class="n">deleteMemPool</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">NextOnFreeList</span> <span class="o">*</span><span class="n">nextPtr</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">nextPtr</span> <span class="o">=</span> <span class="n">freeList</span><span class="p">;</span> <span class="n">nextPtr</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">nextPtr</span> <span class="o">=</span> <span class="n">freeList</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">freeList</span> <span class="o">=</span> <span class="n">freeList</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
            <span class="k">delete</span> <span class="p">[]</span> <span class="n">nextPtr</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="p">}</span>
</pre></table></code></div></div><p>테스트 코드는 이전과 유사하다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="n">TEST</span><span class="p">(</span><span class="n">Chapter6</span><span class="p">,</span> <span class="n">VER2_NEW_DELETE</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">RationalVer2</span><span class="o">*</span> <span class="n">array</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span>

    <span class="n">Rational</span><span class="o">::</span><span class="n">newMemPool</span><span class="p">();</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">5000</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RationalVer2</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">delete</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">Rational</span><span class="o">::</span><span class="n">deleteMemPool</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><p>이번에 만든 메모리 풀 템플릿 버전의 수행시간은 139 millisecond가 걸렸다. 약간이지만 버전 1에 비해서 느린것을 알 수 있다. <strong>버전 3: 단일 쓰레드 가변 크기 메모리 관리자</strong> 가변 크기의 메모리를 필요로하는 응용프로그램들이 있는데, 그 중에 하나가 웹 서버이다. 웹 서버는 문자열 처리를 굉장히 많이 한다. 이로 인해서 가변 크기의 메모리 관리자가 필요로 하는데, 이번에 살펴보도록 하자.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre>    <span class="k">class</span> <span class="nc">MemoryChunk</span> <span class="p">{</span>
    <span class="nl">public:</span>
        <span class="n">MemoryChunk</span><span class="p">(</span><span class="n">MemoryChunk</span> <span class="o">*</span><span class="n">nextChunk</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">chunkSize</span> <span class="o">=</span> <span class="n">DEFAULT_CHUNK_SIZE</span><span class="p">);</span>
        <span class="o">~</span><span class="n">MemoryChunk</span><span class="p">()</span> <span class="p">{</span> <span class="k">delete</span> <span class="n">mem</span><span class="p">;</span> <span class="p">}</span>

        <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span><span class="n">alloc</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>
        <span class="kr">inline</span> <span class="kt">void</span> <span class="n">free</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">someElement</span><span class="p">);</span>

        <span class="n">MemoryChunk</span> <span class="o">*</span><span class="n">nextMemChunk</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">next</span><span class="p">;</span> <span class="p">}</span>

        <span class="kt">size_t</span> <span class="n">spaceAvailable</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">chunkSize</span> <span class="o">-</span> <span class="n">bytesAlreadyAllocated</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">enum</span> <span class="p">{</span> <span class="n">DEFAULT_CHUNK_SIZE</span> <span class="o">=</span> <span class="mi">4096</span> <span class="p">};</span>

    <span class="nl">private:</span>
        <span class="n">MemoryChunk</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
        <span class="kt">void</span>        <span class="o">*</span><span class="n">mem</span><span class="p">;</span>

        <span class="c1">// 단일 메모리 청크 크기</span>
        <span class="kt">size_t</span> <span class="n">chunkSize</span><span class="p">;</span>

        <span class="c1">// 현재 메모리 청크에 할당된 바이트 수</span>
        <span class="kt">size_t</span> <span class="n">bytesAlreadyAllocated</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="kr">inline</span> <span class="kt">void</span><span class="o">*</span> <span class="n">MemoryChunk</span><span class="o">::</span><span class="n">alloc</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">requestSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">void</span> <span class="o">*</span><span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)((</span><span class="kt">size_t</span><span class="p">)(</span><span class="n">mem</span><span class="p">)</span> <span class="o">+</span> <span class="n">bytesAlreadyAllocated</span><span class="p">);</span>
        <span class="n">bytesAlreadyAllocated</span> <span class="o">+=</span> <span class="n">requestSize</span><span class="p">;</span>

        <span class="k">return</span> <span class="n">addr</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">MemoryChunk</span><span class="o">::</span><span class="n">free</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">someElement</span><span class="p">)</span> <span class="p">{</span> 
        <span class="c1">// 할당한 메모리를 재활용하지 않기 때문</span>
    <span class="p">}</span>

    <span class="n">MemoryChunk</span><span class="o">::</span><span class="n">MemoryChunk</span><span class="p">(</span><span class="n">MemoryChunk</span> <span class="o">*</span><span class="n">nextChunk</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">reqSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">chunkSize</span> <span class="o">=</span> <span class="p">(</span><span class="n">reqSize</span> <span class="o">&gt;</span> <span class="n">DEFAULT_CHUNK_SIZE</span><span class="p">)</span> <span class="o">?</span>
                    <span class="n">reqSize</span> <span class="o">:</span> <span class="n">DEFAULT_CHUNK_SIZE</span><span class="p">;</span>
        <span class="n">next</span> <span class="o">=</span> <span class="n">nextChunk</span><span class="p">;</span>
        <span class="n">bytesAlreadyAllocated</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">mem</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">chunkSize</span><span class="p">];</span>
    <span class="p">}</span>
</pre></table></code></div></div><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre>    <span class="k">class</span> <span class="nc">ByteMemoryPool</span> <span class="p">{</span>
    <span class="nl">public:</span>
        <span class="n">ByteMemoryPool</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">initSize</span> <span class="o">=</span> <span class="n">MemoryChunk</span><span class="o">::</span><span class="n">DEFAULT_CHUNK_SIZE</span><span class="p">);</span>
        <span class="o">~</span><span class="n">ByteMemoryPool</span><span class="p">();</span>

        <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span><span class="n">alloc</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">requestSize</span><span class="p">);</span>

        <span class="kr">inline</span> <span class="kt">void</span> <span class="n">free</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">someElement</span><span class="p">);</span>
    <span class="nl">private:</span>
        <span class="n">MemoryChunk</span> <span class="o">*</span><span class="n">listOfMemoryChunks</span><span class="p">;</span>
        <span class="kt">void</span> <span class="n">expandStorage</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">reqSize</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="kr">inline</span> <span class="kt">void</span><span class="o">*</span> <span class="n">ByteMemoryPool</span><span class="o">::</span><span class="n">alloc</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">requestSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">size_t</span> <span class="n">space</span> <span class="o">=</span> <span class="n">listOfMemoryChunks</span><span class="o">-&gt;</span><span class="n">spaceAvailable</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">space</span> <span class="o">&lt;</span> <span class="n">requestSize</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">expandStorage</span><span class="p">(</span><span class="n">requestSize</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">listOfMemoryChunks</span><span class="o">-&gt;</span><span class="n">alloc</span><span class="p">(</span><span class="n">requestSize</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">ByteMemoryPool</span><span class="o">::</span><span class="n">free</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">doomed</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">listOfMemoryChunks</span><span class="o">-&gt;</span><span class="n">free</span><span class="p">(</span><span class="n">doomed</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">ByteMemoryPool</span><span class="o">::</span><span class="n">ByteMemoryPool</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">initSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">expandStorage</span><span class="p">(</span><span class="n">initSize</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">ByteMemoryPool</span><span class="o">::~</span><span class="n">ByteMemoryPool</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">MemoryChunk</span> <span class="o">*</span><span class="n">memChunk</span> <span class="o">=</span> <span class="n">listOfMemoryChunks</span><span class="p">;</span>

        <span class="k">while</span><span class="p">(</span><span class="n">memChunk</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">listOfMemoryChunks</span> <span class="o">=</span> <span class="n">memChunk</span><span class="o">-&gt;</span><span class="n">nextMemChunk</span><span class="p">();</span>
            <span class="k">delete</span> <span class="n">memChunk</span><span class="p">;</span>
            <span class="n">memChunk</span> <span class="o">=</span> <span class="n">listOfMemoryChunks</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">ByteMemoryPool</span><span class="o">::</span><span class="n">expandStorage</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">reqSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">listOfMemoryChunks</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MemoryChunk</span><span class="p">(</span><span class="n">listOfMemoryChunks</span><span class="p">,</span> <span class="n">reqSize</span><span class="p">);</span>
    <span class="p">}</span>
</pre></table></code></div></div><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>    <span class="k">class</span> <span class="nc">RationalVer3</span> <span class="p">{</span>
    <span class="nl">public:</span>
        <span class="n">RationalVer3</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="n">n</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">d</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span>  <span class="p">}</span>
        <span class="o">~</span><span class="n">RationalVer3</span><span class="p">()</span> <span class="p">{</span>  <span class="p">}</span>

        <span class="kt">void</span> <span class="o">*</span><span class="k">operator</span> <span class="k">new</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">memPool</span><span class="o">-&gt;</span><span class="n">alloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span> <span class="p">}</span>
        <span class="kt">void</span> <span class="k">operator</span> <span class="k">delete</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">doomed</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span> <span class="n">memPool</span><span class="o">-&gt;</span><span class="n">free</span><span class="p">(</span><span class="n">doomed</span><span class="p">);</span> <span class="p">}</span>

        <span class="k">static</span> <span class="kt">void</span> <span class="n">newMemPool</span><span class="p">()</span> <span class="p">{</span> <span class="n">memPool</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteMemoryPool</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">static</span> <span class="kt">void</span> <span class="n">deleteMemPool</span><span class="p">()</span> <span class="p">{</span> <span class="k">delete</span> <span class="n">memPool</span><span class="p">;</span> <span class="p">}</span>

    <span class="nl">private:</span>
        <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">d</span><span class="p">;</span>

        <span class="k">static</span> <span class="n">ByteMemoryPool</span> <span class="o">*</span><span class="n">memPool</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="n">ByteMemoryPool</span> <span class="o">*</span><span class="n">RationalVer3</span><span class="o">::</span><span class="n">memPool</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</pre></table></code></div></div><p>이번 버전의 경우 176 millisecond가 걸렸다.  <strong>키 포인트</strong></p><ul><li>메모리 관리의 강력함과 유연성은 성능에 영향을 준다.<li>전역 메모리 관리자는 일반적 목적을 가지고 구현, 성능에는 안 좋다.<li>고정된 크기의 메모리 블록을 주로 할당하면, 특화된 고정 크기 메모리 관리자가 성능에 좋다.<li>단일 쓰레드와 한정된 메모리 블록을 주로 할당하면 위와 같이 성능 개선이 가능.</ul></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/c/" class="post-tag no-text-decoration" >c++</a> <a href="/tags/efficient-c/" class="post-tag no-text-decoration" >Efficient C++</a> <a href="/tags/memory/" class="post-tag no-text-decoration" >Memory</a> <a href="/tags/performance/" class="post-tag no-text-decoration" >Performance</a> <a href="/tags/pool/" class="post-tag no-text-decoration" >Pool</a> <a href="/tags/single-thread/" class="post-tag no-text-decoration" >Single Thread</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=EFFICIENT C++_단일 쓰레드 메모리 풀링 - Appchemist&amp;url=https://appchemist.github.io/posts/efficient-ceb8ba8ec9dbc-ec93b0eba088eb93/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=EFFICIENT C++_단일 쓰레드 메모리 풀링 - Appchemist&amp;u=https://appchemist.github.io/posts/efficient-ceb8ba8ec9dbc-ec93b0eba088eb93/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://appchemist.github.io/posts/efficient-ceb8ba8ec9dbc-ec93b0eba088eb93/&amp;text=EFFICIENT C++_단일 쓰레드 메모리 풀링 - Appchemist" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/DDIA-CH6/">DDIA - 파티셔닝</a><li><a href="/posts/DDIA-CH4/">DDIA - 부호화와_발전</a><li><a href="/posts/clean_architecture_ch20/">클린 아키텍처 - 업무 규칙</a><li><a href="/posts/clean_architecture_ch17/">클린 아키텍처 - 경계 선 긋기</a><li><a href="/posts/DDIA-CH1/">DDIA - 신뢰할 수 있고 확장 가능하며 유지보수하기 쉬운 애플리케이션</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/architecture/">architecture</a> <a class="post-tag" href="/tags/clean-architecture/">clean architecture</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/orm/">ORM</a> <a class="post-tag" href="/tags/c/">c++</a> <a class="post-tag" href="/tags/applicationn/">Applicationn</a> <a class="post-tag" href="/tags/data/">Data</a> <a class="post-tag" href="/tags/system/">System</a> <a class="post-tag" href="/tags/efficient-c/">Efficient C++</a> <a class="post-tag" href="/tags/performance/">Performance</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/efficient-ceba19ceab985eab3bc-eab480eba0/"><div class="card-body"> <em class="timeago small" data-ts="1468183508" > 2016-07-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Efficient C++_로깅과 관련된 성능 이야기</h3><div class="text-muted small"><p> 소프트웨어를 유지보수를 하다보면 로깅이 매우 중요하다. 로깅을 통해서 문제 상황 추적 및 프로그램의 실행 흐름을 파악하는데 많은 도움이 된다. 이런 로깅과 관련된 코드는 성능과 관련된 여러가지 문제들을 만나기 쉽다. 로깅과 관련된 성능 최적화의 극단적인 방법은 추적 호출을 #ifdef 블록 안에 내장하여 성능 부하를 제거하는 것이다. #ifdef ...</p></div></div></a></div><div class="card"> <a href="/posts/867/"><div class="card-body"> <em class="timeago small" data-ts="1468284994" > 2016-07-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>EFFICIENT C++_생성자와 소멸자</h3><div class="text-muted small"><p> 상속 이상적으로는 생성자와 소멸자는 오버헤드를 가지지 않아야 한다. 생성자와 소멸자는 오직 필수적인 초기화와 정리 작업을 수행하며, 일반적인 컴파일러는 이것들을 인라인 함수로 만들것이다. 하지만, 상속과 합성 구현은 가끔 혹은 절대 사용되지 않는 연산을 수행하기도 한다. 상속과 합성 구현은 코드의 재사용을 위한 기술이다. 즉, 코드의 재사용과 성능과...</p></div></div></a></div><div class="card"> <a href="/posts/efficient-ceab080ec8381-ed95a8ec8898/"><div class="card-body"> <em class="timeago small" data-ts="1468331680" > 2016-07-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>EFFICIENT C++_가상 함수</h3><div class="text-muted small"><p> 동적 바인딩 덕분에 프로그래머는 형식 확인을 컴파일러에게 맡기게 되었고 많이 편해졌다. 반대로 동적 바인딩은 성능에 부정적인 영향을 끼칠 수 있다. 가상 함수 기법 만약 가상 함수를 사용하고 싶지 않다면, 직접 형식 확인 코드를 작성하여 동적 바인딩을 흉내를 낼수있다. 다음은 동물원 동물을 클래스로 표현한 것이다. class ZooAnimal {...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/efficient-cec9e84ec8b9c-eab09decb2b4/" class="btn btn-outline-primary" prompt="Older"><p>EFFICIENT C++_임시 객체</p></a> <a href="/posts/overloading-typecasts/" class="btn btn-outline-primary" prompt="Newer"><p>Overloading Typecasts</p></a></div><script src="https://utteranc.es/client.js" repo="appchemist/appchemist.github.io" issue-term="url" crossorigin="anonymous" async> </script> <script type="text/javascript"> $(function() { const origin = "https://utteranc.es"; const iframe = "iframe.utterances-frame"; const lightTheme = "github-light"; const darkTheme = "github-dark"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } addEventListener("message", (event) => { let theme; /* credit to <https://github.com/utterance/utterances/issues/170#issuecomment-594036347> */ if (event.origin === origin) { /* page initial */ theme = initTheme; } else if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); } else { return; } const message = { type: "set-theme", theme: theme }; const utterances = document.querySelector(iframe).contentWindow; utterances.postMessage(message, origin); }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/appchemist">appchemist</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/architecture/">architecture</a> <a class="post-tag" href="/tags/clean-architecture/">clean architecture</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/orm/">ORM</a> <a class="post-tag" href="/tags/c/">c++</a> <a class="post-tag" href="/tags/applicationn/">Applicationn</a> <a class="post-tag" href="/tags/data/">Data</a> <a class="post-tag" href="/tags/system/">System</a> <a class="post-tag" href="/tags/efficient-c/">Efficient C++</a> <a class="post-tag" href="/tags/performance/">Performance</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-KEPDM82EY9"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-KEPDM82EY9'); }); </script>
